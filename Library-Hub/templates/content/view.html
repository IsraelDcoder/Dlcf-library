{% extends "base.html" %}

{% block title %}{{ content.title }} - DLCF e-Library{% endblock %}

{% block content %}
<div class="page-container">
    <div class="content-view">
        <div class="content-header">
            <div class="content-type-icon {{ content.content_type }}">
                <i class="fas {{ content.get_type_icon() }}"></i>
            </div>
            <div class="content-title-section">
                <h1>{{ content.title }}</h1>
                <p class="content-author">by {{ content.author or 'Unknown Author' }}</p>
            </div>
        </div>
        
        <div class="content-details">
            <div class="content-main">
                <div class="content-preview">
                    {% if content.content_type == 'pdf' %}
                    <div class="pdf-viewer">
                        <iframe src="{{ url_for('content.serve_file', content_id=content.id) }}" width="100%" height="600px"></iframe>
                    </div>
                    {% elif content.content_type == 'video' %}
                    <div class="video-player">
                        <video controls width="100%">
                            <source src="{{ url_for('content.serve_file', content_id=content.id) }}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                    {% elif content.content_type == 'audio' or content.content_type == 'live' %}
                    <div class="audio-player">
                        <audio controls>
                            <source src="{{ url_for('content.serve_file', content_id=content.id) }}" type="audio/mpeg">
                            Your browser does not support the audio tag.
                        </audio>
                        {% if content.content_type == 'live' %}
                        <div class="muted small">This is a recorded live session. You can listen here or download the recording.</div>
                        {% endif %}
                    </div>
                    {% else %}
                    <div class="preview-placeholder">
                        <i class="fas {{ content.get_type_icon() }}"></i>
                        <p>Preview not available for this file type</p>
                    </div>
                    {% endif %}
                </div>
                
                {% if content.description %}
                <div class="content-description">
                    <h3>Description</h3>
                    <p>{{ content.description }}</p>
                </div>
                {% endif %}
                
                {% if content.tags %}
                <div class="content-tags">
                    <h3>Tags</h3>
                    <div class="tags-list">
                        {% for tag in content.tags %}
                        <span class="tag">{{ tag.name }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
            
            <aside class="content-sidebar">
                <div class="sidebar-card">
                    <h3>Content Info</h3>
                    <ul class="info-list">
                        <li><i class="fas fa-file"></i> Type: {{ content.content_type.upper() }}</li>
                        <li><i class="fas fa-hdd"></i> Size: {{ content.get_file_size_formatted() }}</li>
                        <li><i class="fas fa-folder"></i> Category: {{ content.category.name if content.category else 'Uncategorized' }}</li>
                        <li><i class="fas fa-calendar"></i> Added: {{ content.created_at.strftime('%b %d, %Y') }}</li>
                        <li><i class="fas fa-eye"></i> Views: {{ content.view_count }}</li>
                        <li><i class="fas fa-download"></i> Downloads: {{ content.download_count }}</li>
                        <li><i class="fas fa-user"></i> Uploaded by: {{ content.uploader.name }}</li>
                    </ul>
                </div>
                
                <div class="sidebar-actions">
                    <a href="{{ url_for('content.download', content_id=content.id) }}" class="btn btn-primary btn-block">
                        <i class="fas fa-download"></i> Download
                    </a>
                    
                    {% if current_user.can_upload() and (content.uploaded_by == current_user.id or current_user.is_admin()) %}
                    <a href="{{ url_for('content.edit', content_id=content.id) }}" class="btn btn-outline btn-block">
                        <i class="fas fa-edit"></i> Edit
                    </a>
                    <form action="{{ url_for('content.delete', content_id=content.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this content?');">
                        <button type="submit" class="btn btn-danger btn-block">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </form>
                    {% endif %}
                </div>
            </aside>
        </div>
        
        {% if related %}
        <div class="related-content">
            <h2>Related Content</h2>
            <div class="content-grid">
                {% for item in related %}
                <div class="content-card">
                    <div class="content-type-badge {{ item.content_type }}">
                        <i class="fas {{ item.get_type_icon() }}"></i>
                    </div>
                    <h3>{{ item.title }}</h3>
                    <p class="content-author">{{ item.author or 'Unknown Author' }}</p>
                    <a href="{{ url_for('content.view', content_id=item.id) }}" class="btn btn-sm">View</a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
